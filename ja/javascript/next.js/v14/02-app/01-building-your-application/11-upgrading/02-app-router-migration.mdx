---
filePath: source/next.js/docs/02-app/01-building-your-application/11-upgrading/02-app-router-migration.mdx
title: App Router Incremental Adoption Guide
description: Learn how to upgrade your existing Next.js application from the Pages Router to the App Router.
org_title: App Router Incremental Adoption Guide
org_path: /docs/app/building-your-application/upgrading/app-router-migration
is_empty: false
nav_title: App Router Migration
---

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã‚ãªãŸã‚’åŠ©ã‘ã¾ã™ï¼š

- [ã‚ãªãŸã® Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ version 12 ã‹ã‚‰ version 13 ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ](#nextjs-version)
- [`pages` ãŠã‚ˆã³ `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸¡æ–¹ã§æ©Ÿèƒ½ã™ã‚‹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ©Ÿèƒ½](#upgrading-new-features)
- [æ—¢å­˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ `pages` ã‹ã‚‰ `app` ã¸æ®µéšçš„ã«ç§»è¡Œã—ã¾ã™](#migrating-from-pages-to-app)

## Upgrading

### Node.js Version

æœ€å°ã® Node.js version ã¯ç¾åœ¨**v18.17**ã§ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[Node.js ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³](https://nodejs.org/docs/latest-v18.x/api/)ã‚’ã”è¦§ãã ã•ã„ã€‚

### Next.js Version

ã‚ãªãŸã®å¥½ã¿ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€Next.js version13 ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```bash:Terminal
npm install next@latest react@latest react-dom@latest
```

### ESLint Version

ã‚ãªãŸãŒ ESLint ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€ã‚ãªãŸã® ESLint version ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```bash:Terminal
npm install -D eslint-config-next@latest
```

> **Good to know**: ESLint server ã®å¤‰æ›´ãŒåæ˜ ã•ã‚Œã‚‹ãŸã‚ã«ã¯ã€VS Code ã§ ESLint server ã‚’å†èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆ(Mac ã§ã¯`cmd+shift+p`ã€Windows ã§ã¯`ctrl+shift+p`)ã‚’é–‹ãã€`ESLint: Restart ESLint Server`ã§æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚

## Next Steps

æ›´æ–°ãŒå®Œäº†ã—ãŸå¾Œã¯ã€ next ã‚¹ãƒ†ãƒƒãƒ—ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„ï¼š

- [æ–°æ©Ÿèƒ½ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰](#upgrading-new-features): æ”¹å–„ã•ã‚ŒãŸ Image ã‚„ Link ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãªã©ã€æ–°æ©Ÿèƒ½ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚
- [`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ç§»è¡Œ](#migrating-from-pages-to-app)ï¼š`pages`ã‹ã‚‰`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸æ®µéšçš„ã«ç§»è¡Œã™ã‚‹ãŸã‚ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã€‚

## Upgrading New Features

Next.js 13 ã¯ã€æ–°æ©Ÿèƒ½ã¨è¦ç´„ã‚’å‚™ãˆãŸæ–°ã—ã„[App Router](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing)ã‚’å°å…¥ã—ã¾ã—ãŸã€‚æ–°ã—ã„ Router ã¯ `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§åˆ©ç”¨å¯èƒ½ã§ã€`pages` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨å…±å­˜ã—ã¾ã™ã€‚

Next.js 13 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã‚‚ã€æ–°ã—ã„[App Router](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing#the-app-router)ã‚’ require ã§ä½¿ç”¨ã™ã‚‹å¿…è¦ã¯**ã‚ã‚Šã¾ã›ã‚“**ã€‚æ–°ã—ã„æ©Ÿèƒ½ã‚’ä½¿ã£ãŸ `pages` ã®ä½¿ç”¨ã‚’ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã‚‰ã®æ–°æ©Ÿèƒ½ã¯ã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚ŒãŸ[Image component](#image-component)ã€[Link component](#link-component)ã€[Script component](#script-component)ã€ãã—ã¦[Font optimization](#font-optimization)ãªã©ã€ã©ã¡ã‚‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã‚‚å‹•ä½œã—ã¾ã™ã€‚

### `<Image/>` Component

Next.js 12 ã¯ã€ä¸€æ™‚çš„ãª importï¼š`next/future/image`ã¨ã¨ã‚‚ã«ã€Image Component ã«æ–°ã—ã„æ”¹è‰¯ã‚’å°å…¥ã—ã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®æ”¹è‰¯ã«ã¯ã€Client å´ã® JavaScript ã®å‰Šæ¸›ã€ç”»åƒã®æ‹¡å¼µã‚„ style ã‚’ã‚ˆã‚Šç°¡å˜ã«è¡Œã†æ–¹æ³•ã€ã‚ˆã‚Šè‰¯ã„ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã€ãŠã‚ˆã³ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãª lazy loading ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

version13 ã§ã¯ã€ã“ã®æ–°ã—ã„å‹•ä½œãŒ `next/image` ã® default ã«ãªã‚Šã¾ã—ãŸã€‚

æ–°ã—ã„ Image Component ã«ç§»è¡Œã™ã‚‹ãŸã‚ã® 2 ã¤ã® codemods ãŒã‚ã‚Šã¾ã™ï¼š

- [**`next-image-to-legacy-image` codemod**](/ja/javascript/next.js/v14/02-app/01-building-your-application/11-upgrading/01-codemods#next-image-to-legacy-image): å®‰å…¨ã‹ã¤è‡ªå‹•ã§ `next/image` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ `next/legacy/image` ã«åå‰å¤‰æ›´ã—ã¾ã™ã€‚æ—¢å­˜ã® Component ã¯åŒã˜å‹•ä½œã‚’ç¶­æŒã—ã¾ã™ã€‚
- [**`next-image-experimental` ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒƒãƒ‰**](/ja/javascript/next.js/v14/02-app/01-building-your-application/11-upgrading/01-codemods#next-image-experimental): å±é™ºãªã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã® styles ã‚’è¿½åŠ ã—ã€æœªä½¿ç”¨ã® props ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ—¢å­˜ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹•ä½œãŒæ–°ã—ã„ default ã«åˆã‚ã›ã¦å¤‰æ›´ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ã¾ãš `next-image-to-legacy-image` ã‚³ãƒ¼ãƒ‰ãƒ¢ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### `<Link>` Component

[`<Link>` Component](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/03-linking-and-navigating#link-component)ã¯ã€å­ã¨ã—ã¦`<a>`ã‚¿ã‚°ã‚’æ‰‹å‹•ã§è¿½åŠ ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã—ãŸã€‚ã“ã®å‹•ä½œã¯ã€[version 12.2](https://nextjs.org/blog/next-12-2)ã§å®Ÿé¨“çš„ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¿½åŠ ã•ã‚Œã€ç¾åœ¨ã¯ default ã¨ãªã£ã¦ã„ã¾ã™ã€‚Next.js 13 ã§ã¯ã€`<Link>`ã¯å¸¸ã«`<a>`ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€props ã‚’åŸºç¤ã¨ãªã‚‹ã‚¿ã‚°ã«è»¢é€ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

For example:

```jsx
import Link from 'next/link'

// Next.js 12: `<a>` has to be nested otherwise it's excluded
<Link href="/about">
  <a>About</a>
</Link>

// Next.js 13: `<Link>` always renders `<a>` under the hood
<Link href="/about">
  About
</Link>
```

ã‚ãªãŸã®ãƒªãƒ³ã‚¯ã‚’ Next.js 13 ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€[`new-link` codemod](/ja/javascript/next.js/v14/02-app/01-building-your-application/11-upgrading/01-codemods#new-link)ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

### `<Script>` Component

[`next/script`](/ja/javascript/next.js/v14/02-app/02-api-reference/01-components/script)ã®æŒ™å‹•ãŒã€`pages`ã¨`app`ã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸãŒã€ã‚¹ãƒ ãƒ¼ã‚ºãªç§»è¡Œã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«ã¯ã„ãã¤ã‹ã®å¤‰æ›´ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ï¼š

- ä»¥å‰ã«`_document.js`ã«å«ã‚ã¦ã„ãŸå…¨ã¦ã®`beforeInteractive`ã® scripts ã‚’ã€root layout ãƒ•ã‚¡ã‚¤ãƒ«(`app/layout.tsx`)ã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚
- å®Ÿé¨“çš„ãª`worker` strategy ã¯ã¾ã  `app`ã§å‹•ä½œã›ãšã€ã“ã® strategy ã‚’æŒ‡å®šã—ãŸ scripts ã¯å‰Šé™¤ã™ã‚‹ã‹ã€åˆ¥ã® strategy (ä¾‹ï¼š`lazyOnload`)ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- `onLoad`ã€`onReady`ã€ãã—ã¦ `onError` ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ©ãƒ¼ã¯ Server Components ã§å‹•ä½œã—ã¾ã›ã‚“ã®ã§ã€ãã‚Œã‚‰ã‚’[Client Component](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/01-server-components)ã«ç§»å‹•ã™ã‚‹ã‹ã€å®Œå…¨ã«å‰Šé™¤ã™ã‚‹ã‚ˆã†ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### ãƒ•ã‚©ãƒ³ãƒˆæœ€é©åŒ–

ä»¥å‰ã€Next.js ã¯[inlining font CSS](/ja/javascript/next.js/v14/02-app/01-building-your-application/06-optimizing/03-fonts)ã«ã‚ˆã£ã¦ãƒ•ã‚©ãƒ³ãƒˆã®æœ€é©åŒ–ã‚’æ”¯æ´ã—ã¦ã„ã¾ã—ãŸã€‚Version 13 ã§ã¯ã€æ–°ãŸã«[`next/font`](/docs/app/building-your-application/optimizing/fonts)ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå°å…¥ã•ã‚Œã€å„ªã‚ŒãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ç¶­æŒã—ãªãŒã‚‰ãƒ•ã‚©ãƒ³ãƒˆ loading çµŒé¨“ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹èƒ½åŠ›ã‚’æä¾›ã—ã¾ã™ã€‚`next/font`ã¯ã€`pages`ãŠã‚ˆã³`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸¡æ–¹ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

`pages`ã§[inlining CSS](/ja/javascript/next.js/v14/02-app/01-building-your-application/06-optimizing/03-fonts)ã¯ã¾ã æ©Ÿèƒ½ã—ã¾ã™ãŒã€`app`ã§ã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«[`next/font`](/docs/app/building-your-application/optimizing/fonts)ã‚’ä½¿ç”¨ã™ã¹ãã§ã™ã€‚

`next/font`ã®ä½¿ã„æ–¹ã‚’å­¦ã¶ãŸã‚ã«ã€[Font Optimization](/ja/javascript/next.js/v14/02-app/01-building-your-application/06-optimizing/03-fonts)ã®ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ã€‚

## Migrating from `pages` to `app`

> **ğŸ¥ è¦–è´:** App Router ã‚’å°‘ã—ãšã¤æ¡ç”¨ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ â†’ [YouTube (16 åˆ†)](https://www.youtube.com/watch?v=YQMSietiFm0).

App Router ã¸ã®ç§»è¡Œã¯ã€Next.js ãŒä¸Šã«æ§‹ç¯‰ã™ã‚‹ React ã®æ©Ÿèƒ½ã‚’åˆã‚ã¦ä½¿ç”¨ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã«ã¯ Server Componentsã€Suspense ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚ [ç‰¹åˆ¥ãªãƒ•ã‚¡ã‚¤ãƒ«](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing#file-conventions) ã‚„ [Layout](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/02-pages-and-layouts#layouts) ãªã©ã®æ–°ã—ã„ Next.js ã®æ©Ÿèƒ½ã¨çµ„ã¿åˆã‚ã•ã‚Œã‚‹ã¨ã€ç§»è¡Œã¯æ–°ã—ã„æ¦‚å¿µã€æ€è€ƒãƒ¢ãƒ‡ãƒ«ã€è¡Œå‹•å¤‰æ›´ã‚’å­¦ç¿’ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®æ›´æ–°ã®è¤‡åˆçš„ãªè¤‡é›‘ã•ã‚’ã€ç§»è¡Œã‚’ã‚ˆã‚Šå°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†å‰²ã™ã‚‹ã“ã¨ã§è»½æ¸›ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯æ„å›³çš„ã«ã€ãƒšãƒ¼ã‚¸ã”ã¨ã®å¢—åˆ†çš„ãªç§»è¡Œã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã«ã€`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨åŒæ™‚ã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- `app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãƒã‚¹ãƒˆã•ã‚ŒãŸ routes _ã¨_ Layout ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚[è©³ã—ãã¯ã“ã¡ã‚‰](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing)ã€‚
- ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½¿ç”¨ã—ã¦[routes ã‚’å®šç¾©ã™ã‚‹](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/01-defining-routes)ã¨ã€ç‰¹åˆ¥ãª`page.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ route ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’å…¬é–‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚[è©³ã—ãã¯ã“ã¡ã‚‰](#step-4-migrating-pages)ã€‚
- [Special file conventions](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing#file-conventions)ã¯ã€ãã‚Œãã‚Œã® route ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã® UI ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æœ€ã‚‚ä¸€èˆ¬çš„ãªç‰¹åˆ¥ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`page.js`ã¨`layout.js`ã§ã™ã€‚
  - `page.js`ã‚’ä½¿ç”¨ã—ã¦ã€route ã«å›ºæœ‰ã® UI ã‚’å®šç¾©ã—ã¾ã™ã€‚
  - `layout.js`ã‚’ä½¿ç”¨ã—ã¦ã€è¤‡æ•°ã® routes ã§å…±æœ‰ã•ã‚Œã‚‹ UI ã‚’å®šç¾©ã—ã¦ãã ã•ã„ã€‚
  - ç‰¹åˆ¥ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€`.js`ã€`.jsx`ã€ã¾ãŸã¯`.tsx`ã®ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚
- ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…±å­˜ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ styles ã€ãƒ†ã‚¹ãƒˆãªã©ã§ã™ã€‚[è©³ã—ãã¯ã“ã¡ã‚‰](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing)ã€‚
- `getServerSideProps`ã‚„`getStaticProps`ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿å–å¾—æ©Ÿèƒ½ã¯ã€`app`å†…ã®æ–°ã—ã„ API[ãƒªãƒ³ã‚¯](/ja/javascript/next.js/v14/02-app/01-building-your-application/02-data-fetching)ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚`getStaticPaths`ã¯[`generateStaticParams`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/generate-static-params)ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚
- `pages/_app.js` ã¨ `pages/_document.js` ã¯ä¸€ã¤ã®`app/layout.js` root layout ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚[ã‚‚ã£ã¨è©³ã—ã](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/02-pages-and-layouts#root-layout-required)ã€‚
- `pages/_error.js`ã¯ã€ã‚ˆã‚Šè©³ç´°ãª`error.js`ç‰¹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚[è©³ç´°ã‚’å­¦ã¶](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/05-error-handling)ã€‚
- `pages/404.js`ã¯[`not-found.js`](/ja/javascript/next.js/v14/02-app/02-api-reference/02-file-conventions/not-found)ãƒ•ã‚¡ã‚¤ãƒ«ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚
- `pages/api/*` API Routes ãŒç‰¹åˆ¥ãªãƒ•ã‚¡ã‚¤ãƒ« [`route.js`](/ja/javascript/next.js/v14/02-app/02-api-reference/02-file-conventions/route)(Route Handler)ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 1ï¼š `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

æœ€æ–°ã® Next.js version ã«æ›´æ–°ã—ã¦ãã ã•ã„(13.4 ä»¥ä¸ŠãŒå¿…è¦)ï¼š

```bash
npm install next@latest
```

æ¬¡ã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® root(ã¾ãŸã¯`src/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)ã«æ–°ã—ã„`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šRoot Layout ã®ä½œæˆ

æ–°ã—ã„ `app/layout.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã«ä½œæˆã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯ã€`app` å†…ã®ã™ã¹ã¦ã® routes ã«é©ç”¨ã•ã‚Œã‚‹[root layout](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/02-pages-and-layouts#root-layout-required)ã§ã™ã€‚

```tsx:app/layout.tsx
export default function RootLayout({
  // Layouts must accept a children prop.
  // This will be populated with nested layouts or pages
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

```jsx:app/layout.js
export default function RootLayout({
  // Layouts must accept a children prop.
  // This will be populated with nested layouts or pages
  children,
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

- `app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€root layout ãŒ**å¿…ãš**å«ã¾ã‚Œã¦ã„ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
- root layout ã¯ã€`<html>`ã¨`<body>`ã‚¿ã‚°ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãªãœãªã‚‰ã€Next.js ã¯ãã‚Œã‚‰ã‚’è‡ªå‹•çš„ã«ä½œæˆã—ãªã„ã‹ã‚‰ã§ã™ã€‚
- root layout ã¯ã€`pages/_app.tsx`ã¨`pages/_document.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãæ›ãˆã¾ã™ã€‚
- layout ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€`.js`ã€`.jsx`ã€ã¾ãŸã¯`.tsx`ã®æ‹¡å¼µå­ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

`<head>` HTML è¦ç´ ã‚’ç®¡ç†ã™ã‚‹ã«ã¯ã€[çµ„ã¿è¾¼ã¿ã® SEO ã‚µãƒãƒ¼ãƒˆ](/ja/javascript/next.js/v14/02-app/01-building-your-application/06-optimizing/04-metadata)ã‚’ä½¿ç”¨ã§ãã¾ã™:

```tsx:app/layout.tsx
import { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Home',
  description: 'Welcome to Next.js',
}
```

```jsx:app/layout.js
export const metadata = {
  title: 'Home',
  description: 'Welcome to Next.js',
}
```

#### `_document.js`ã¨`_app.js`ã®ç§»è¡Œ

æ—¢å­˜ã® `_app` ã¾ãŸã¯ `_document` ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã€å†…å®¹(ä¾‹ãˆã°ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª Styles )ã‚’ root layout (`app/layout.tsx`) ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ `app/layout.tsx` ã® styles ã¯ã€ `pages/*` ã«ã¯é©ç”¨ã•ã‚Œ*ã¾ã›ã‚“*ã€‚ç§»è¡Œä¸­ã¯ `_app`/`_document` ã‚’ä¿æŒã—ã€`pages/*` ã® routes ãŒå£Šã‚Œã‚‹ã®ã‚’é˜²ãã¹ãã§ã™ã€‚å®Œå…¨ã«ç§»è¡ŒãŒå®Œäº†ã—ãŸã‚‰ã€ãã‚Œã‚‰ã‚’å®‰å…¨ã« delete ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚ãªãŸãŒ React Context ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚‰ã¯ [Client Component](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/02-client-components)ã«ç§»å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### `getLayout()`ãƒ‘ã‚¿ãƒ¼ãƒ³ã® Layouts ã¸ã®ç§»è¡Œ(ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«)

Next.js ã¯ã€`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒšãƒ¼ã‚¸ã”ã¨ã® Layout ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€[PageComponent ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹](/ja/javascript/next.js/v14/03-pages/01-building-your-application/01-routing/01-pages-and-layouts#layout-pattern#per-page-layouts)ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã—ãŸã€‚ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã®[nested layouts](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/02-pages-and-layouts#layouts)ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆã«ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<details>
  <summary>See before and after example</summary>

**Before**

```jsx:components/DashboardLayout.js
export default function DashboardLayout({ children }) {
  return (
    <div>
      <h2>My Dashboard</h2>
      {children}
    </div>
  )
}
```

```jsx:pages/dashboard/index.js
import DashboardLayout from '../components/DashboardLayout'

export default function Page() {
  return <p>My Page</p>
}

Page.getLayout = function getLayout(page) {
  return <DashboardLayout>{page}</DashboardLayout>
}
```

**After**

- `Page.getLayout` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ `pages/dashboard/index.js` ã‹ã‚‰å‰Šé™¤ã—ã€[ãƒšãƒ¼ã‚¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †](#step-4-migrating-pages)ã«å¾“ã£ã¦ `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»è¡Œã—ã¦ãã ã•ã„ã€‚

  ```jsx filename="app/dashboard/page.js"
  export default function Page() {
    return <p>My Page</p>;
  }
  ```

- `DashboardLayout`ã®å†…å®¹ã‚’æ–°ã—ã„[Client Component](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/02-client-components)ã«ç§»å‹•ã—ã¦ã€`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å‹•ä½œã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚

  ```jsx filename="app/dashboard/DashboardLayout.js"
  "use client"; // this directive should be at top of the file, before any imports.

  // This is a Client Component
  export default function DashboardLayout({ children }) {
    return (
      <div>
        <h2>My Dashboard</h2>
        {children}
      </div>
    );
  }
  ```

- `app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®æ–°ã—ã„`layout.js`ãƒ•ã‚¡ã‚¤ãƒ«ã«`DashboardLayout`ã‚’ Import ã—ã¦ãã ã•ã„ã€‚

  ```jsx filename="app/dashboard/layout.js"
  import DashboardLayout from "./DashboardLayout";

  // This is a Server Component
  export default function Layout({ children }) {
    return <DashboardLayout>{children}</DashboardLayout>;
  }
  ```

- `DashboardLayout.js`ã®éã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªéƒ¨åˆ†ã‚’( Client Component )ã‹ã‚‰`layout.js`( Server Component )ã«é€æ¬¡ç§»å‹•ã•ã›ã‚‹ã“ã¨ã§ã€ client ã«é€ä¿¡ã™ã‚‹ component JavaScript ã®é‡ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

</details>

### ã‚¹ãƒ†ãƒƒãƒ— 3ï¼š `next/head` ã®ç§»è¡Œ

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`next/head` React component ãŒ`<head>` HTML è¦ç´ (`title`ã€`meta`ãªã©)ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`next/head`ã¯æ–°ã—ã„[çµ„ã¿è¾¼ã¿ã® SEO ã‚µãƒãƒ¼ãƒˆ](/ja/javascript/next.js/v14/02-app/01-building-your-application/06-optimizing/04-metadata)ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚

**Before:**

```tsx:pages/index.tsx
import Head from 'next/head'

export default function Page() {
  return (
    <>
      <Head>
        <title>My page title</title>
      </Head>
    </>
  )
}
```

```jsx:pages/index.js
import Head from 'next/head'

export default function Page() {
  return (
    <>
      <Head>
        <title>My page title</title>
      </Head>
    </>
  )
}
```

**After:**

```tsx:app/page.tsx
import { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'My Page Title',
}

export default function Page() {
  return '...'
}
```

```jsx:app/page.js
export const metadata = {
  title: 'My Page Title',
}

export default function Page() {
  return '...'
}
```

ã™ã¹ã¦ã® metadata options ã‚’[å‚ç…§](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/generate-metadata)ã—ã¦ãã ã•ã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 4ï¼šãƒšãƒ¼ã‚¸ã®ç§»è¡Œ

- [`app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing)å†…ã®ãƒšãƒ¼ã‚¸ã¯ã€ default ã§[Server Components](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/01-server-components)ã§ã™ã€‚ã“ã‚Œã¯ `pages` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã¯ç•°ãªã‚Šã€ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸ã¯[Client Components](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/02-client-components)ã§ã™ã€‚
- [ãƒ‡ãƒ¼ã‚¿å–å¾—](/ja/javascript/next.js/v14/02-app/01-building-your-application/02-data-fetching)ã¯ `app` ã§å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚`getServerSideProps`ã€`getStaticProps`ã€ãŠã‚ˆã³ `getInitialProps`ã¯ã€ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ãª API ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚
- `app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½¿ç”¨ã—ã¦[routes ã‚’å®šç¾©ã™ã‚‹](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/01-defining-routes)ãŸã‚ã€ãã—ã¦ç‰¹åˆ¥ãª`page.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ route ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’å…¬ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚
- | `pages` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | Route | | ----------------- | --------------------- | -------------- | | `index.js` | `page.js` | `/` | | `about.js` | `about/page.js` | `/about` | | `blog/[slug].js` | `blog/[slug]/page.js` | `/blog/post-1` |

ãƒšãƒ¼ã‚¸ã®ç§»è¡Œã‚’ä¸»ã« 2 ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†è§£ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼š

- ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šexport ã•ã‚ŒãŸ default ãƒšãƒ¼ã‚¸ Component ã‚’æ–°ã—ã„ Client Component ã«ç§»å‹•ã—ã¾ã™ã€‚
- ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šæ–°ã—ã„`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®æ–°ã—ã„`page.js`ãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„ Client Component ã‚’ Import ã—ã¾ã™ã€‚

> **Good to know**: ã“ã‚ŒãŒæœ€ã‚‚`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¿‘ã„å‹•ä½œã‚’ã™ã‚‹ãŸã‚ã€æœ€ã‚‚ç°¡å˜ãªç§»è¡Œ path ã§ã™ã€‚

**ã‚¹ãƒ†ãƒƒãƒ— 1ï¼šæ–°ã—ã„ Client Component ã‚’ä½œæˆã™ã‚‹**

- `app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«æ–°ã—ã„åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«(ä¾‹ `app/home-page.tsx` ãªã©)ã‚’ä½œæˆã—ã€ãã®ä¸­ã« Client Component ã‚’ export ã—ã¾ã™ã€‚ Client Components ã‚’å®šç¾©ã™ã‚‹ã«ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­(ã©ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚ˆã‚Šã‚‚å‰)ã«`'use client'`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’è¿½åŠ ã—ã¾ã™ã€‚
  - Pages Router ã¨åŒæ§˜ã«ã€åˆå›ã®ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã« Client Components ã‚’é™çš„ HTML ã«ãƒ—ãƒ¬ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã®[æœ€é©åŒ–ã‚¹ãƒ†ãƒƒãƒ—](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/02-client-components#full-page-load)ãŒã‚ã‚Šã¾ã™ã€‚
- `pages/index.js`ã‹ã‚‰`app/home-page.tsx`ã¸ã¨ã€default ã¨ã„ã† export ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ component ã‚’ç§»å‹•ã•ã›ã¦ãã ã•ã„ã€‚

```tsx:app/home-page.tsx
'use client'

// This is a Client Component (same as components in the `pages` directory)
// It receives data as props, has access to state and effects, and is
// prerendered on the server during the initial page load.
export default function HomePage({ recentPosts }) {
  return (
    <div>
      {recentPosts.map((post) => (
        <div key={post.id}>{post.title}</div>
      ))}
    </div>
  )
}
```

```jsx:app/home-page.js
'use client'

// This is a Client Component. It receives data as props and
// has access to state and effects just like Page components
// in the `pages` directory.
export default function HomePage({ recentPosts }) {
  return (
    <div>
      {recentPosts.map((post) => (
        <div key={post.id}>{post.title}</div>
      ))}
    </div>
  )
}
```

**ã‚¹ãƒ†ãƒƒãƒ— 2ï¼šæ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹**

- æ–°ã—ã„ `app/page.tsx` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ default ã§ Server Component ã§ã™ã€‚
- ãƒšãƒ¼ã‚¸ã«`home-page.tsx`ã® Import Client Component ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
- `pages/index.js`ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ãŸå ´åˆã€æ–°ã—ã„[data fetching APIs](/ja/javascript/next.js/v14/02-app/01-building-your-application/02-data-fetching/01-fetching-caching-and-revalidating)ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç›´æ¥ Server Component ã«ç§»å‹•ã—ã¾ã™ã€‚è©³ç´°ã¯[data fetching upgrade guide](#step-6-migrating-data-fetching-methods)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

  ```tsx filename="app/page.tsx" switcher
  // Import your Client Component
  import HomePage from "./home-page";

  async function getPosts() {
    const res = await fetch("https://...");
    const posts = await res.json();
    return posts;
  }

  export default async function Page() {
    // Fetch data directly in a Server Component
    const recentPosts = await getPosts();
    // Forward fetched data to your Client Component
    return <HomePage recentPosts={recentPosts} />;
  }
  ```

  ```jsx filename="app/page.js" switcher
  // Import your Client Component
  import HomePage from "./home-page";

  async function getPosts() {
    const res = await fetch("https://...");
    const posts = await res.json();
    return posts;
  }

  export default async function Page() {
    // Fetch data directly in a Server Component
    const recentPosts = await getPosts();
    // Forward fetched data to your Client Component
    return <HomePage recentPosts={recentPosts} />;
  }
  ```

- ã‚ãªãŸã®å‰ã®ãƒšãƒ¼ã‚¸ãŒ `useRouter` ã‚’ä½¿ç”¨ã—ã¦ã„ãŸå ´åˆã€æ–°ã—ã„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° hook ã¸ã®æ›´æ–°ãŒå¿…è¦ã§ã™ã€‚ [ã‚‚ã£ã¨è©³ã—ã](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/use-router)ã€‚
- Start ã‚’æŠ¼ã—ã¦ã€ã‚ãªãŸã® development server ã‚’å§‹ã‚ã€[`EXL0005`](http://localhost:3000)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚ã™ã§ã«å­˜åœ¨ã™ã‚‹ index route ãŒã€ä»Šã¯ app ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é€šã˜ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 5ï¼šãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° hook ã®ç§»è¡Œ

æ–°ã—ã„ router ãŒè¿½åŠ ã•ã‚Œã€`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ–°ã—ã„å‹•ä½œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

`app`ã§ã¯ã€`next/navigation`ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸ 3 ã¤ã®æ–°ã—ã„ hook ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š[`useRouter()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/use-router)ã€[`usePathname()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/use-pathname)ã€ãã—ã¦[`useSearchParams()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/use-search-params)ã€‚

- æ–°ã—ã„`useRouter` hook ã¯ã€`next/navigation`ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã€`next/router`ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã‚‹`pages`ã®ä¸­ã®`useRouter` hook ã¨ã¯ç•°ãªã‚‹å‹•ä½œã‚’æŒã£ã¦ã„ã¾ã™ã€‚
  - `next/router`ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã‚‹[`useRouter` hook](/ja/javascript/next.js/v14/03-pages/02-api-reference/02-functions/use-router)ã¯ã€`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯å¼•ãç¶šãä½¿ç”¨ã§ãã¾ã™ã€‚
- æ–°ã—ã„`useRouter`ã¯`pathname`ã® string ã‚’è¿”ã—ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«åˆ¥ã®`usePathname`ã® hook ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
- æ–°ã—ã„`useRouter`ã¯`query`ã® object ã‚’è¿”ã—ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã€åˆ¥ã®`useSearchParams`ã® hook ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
- `useSearchParams` ã¨`usePathname` ã‚’åŒæ™‚ã«ä½¿ç”¨ã—ã¦ãƒšãƒ¼ã‚¸ã®å¤‰æ›´ã‚’ãƒªã‚¹ãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ç´°ã¯[Router Events](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/use-router#router-events)ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
- ã“ã‚Œã‚‰ã®æ–°ã—ã„ hook ã¯ã€Client Components ã§ã®ã¿ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚Server Components ã§ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚

```tsx:app/example-client-component.tsx
'use client'

import { useRouter, usePathname, useSearchParams } from 'next/navigation'

export default function ExampleClientComponent() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  // ...
}
```

```jsx:app/example-client-component.js
'use client'

import { useRouter, usePathname, useSearchParams } from 'next/navigation'

export default function ExampleClientComponent() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  // ...
}
```

ã•ã‚‰ã«ã€æ–°ãŸãª `useRouter` hook ã«ã¯ä»¥ä¸‹ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™ï¼š

- `isFallback`ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ãªãœãªã‚‰ã€`fallback`ãŒ[ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸ](#replacing-fallback)ã‹ã‚‰ã§ã™ã€‚
- `locale`ã€`locales`ã€`defaultLocales`ã€`domainLocales`ã®å€¤ã¯ã€`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã® i18n Next.js æ©Ÿèƒ½ãŒã‚‚ã¯ã‚„å¿…è¦ãªã„ãŸã‚å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚[i18n ã«ã¤ã„ã¦ã‚‚ã£ã¨å­¦ã¶](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/14-internationalization)ã€‚
- `basePath`ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ä»£æ›¿æ‰‹æ®µã¯`useRouter`ã®ä¸€éƒ¨ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
- `asPath`ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ãªãœãªã‚‰ã€æ–°ã—ã„ router ã‹ã‚‰`as`ã®æ¦‚å¿µãŒå‰Šé™¤ã•ã‚ŒãŸã‹ã‚‰ã§ã™ã€‚
- `isReady`ã¯ã‚‚ã¯ã‚„å¿…è¦ãªã„ãŸã‚ã€å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ [static rendering](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/01-server-components#static-rendering-default)ã®é–“ã«ã€[`useSearchParams()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/use-search-params) hook ã‚’ä½¿ç”¨ã™ã‚‹ã‚ã‚‰ã‚†ã‚‹ component ã¯ã€ãƒ—ãƒ¬ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ä»£ã‚ã‚Šã« client ã§ runtime ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

[`useRouter()` API reference ã‚’è¦‹ã‚‹](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/use-router)ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 6ï¼šãƒ‡ãƒ¼ã‚¿å–å¾—æ–¹æ³•ã®ç§»è¡Œ

`pages` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€ãƒšãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’ fetch ã™ã‚‹ãŸã‚ã« `getServerSideProps` ã¨ `getStaticProps` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ã¯ã€ã“ã‚Œã‚‰ã®ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒé–¢æ•°ã¯ã€`fetch()` ã¨ `async` React Server Components ã‚’åŸºç›¤ã«ã—ãŸ[ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ãª API](/ja/javascript/next.js/v14/02-app/01-building-your-application/02-data-fetching)ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚

```tsx:app/page.tsx
export default async function Page() {
  // This request should be cached until manually invalidated.
  // Similar to `getStaticProps`.
  // `force-cache` is the default and can be omitted.
  const staticData = await fetch(`https://...`, { cache: 'force-cache' })

  // This request should be refetched on every request.
  // Similar to `getServerSideProps`.
  const dynamicData = await fetch(`https://...`, { cache: 'no-store' })

  // This request should be cached with a lifetime of 10 seconds.
  // Similar to `getStaticProps` with the `revalidate` option.
  const revalidatedData = await fetch(`https://...`, {
    next: { revalidate: 10 },
  })

  return <div>...</div>
}
```

```jsx:app/page.js
export default async function Page() {
  // This request should be cached until manually invalidated.
  // Similar to `getStaticProps`.
  // `force-cache` is the default and can be omitted.
  const staticData = await fetch(`https://...`, { cache: 'force-cache' })

  // This request should be refetched on every request.
  // Similar to `getServerSideProps`.
  const dynamicData = await fetch(`https://...`, { cache: 'no-store' })

  // This request should be cached with a lifetime of 10 seconds.
  // Similar to `getStaticProps` with the `revalidate` option.
  const revalidatedData = await fetch(`https://...`, {
    next: { revalidate: 10 },
  })

  return <div>...</div>
}
```

#### Server-side Rendering (`getServerSideProps`)

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`getServerSideProps`ãŒä½¿ã‚ã‚Œã¦ server ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’ fetch ã—ã€props ã‚’ãƒ•ã‚¡ã‚¤ãƒ«å†…ã® default ã§ export ã•ã‚ŒãŸ React component ã«è»¢é€ã—ã¾ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¸ã®åˆæœŸ HTML ã¯ server ã‹ã‚‰ãƒ—ãƒ¬ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€æ¬¡ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒšãƒ¼ã‚¸ã‚’ "hydrating"(ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹)ã—ã¾ã™ã€‚

```jsx:pages/dashboard.js
// `pages` directory

export async function getServerSideProps() {
  const res = await fetch(`https://...`)
  const projects = await res.json()

  return { props: { projects } }
}

export default function Dashboard({ projects }) {
  return (
    <ul>
      {projects.map((project) => (
        <li key={project.id}>{project.name}</li>
      ))}
    </ul>
  )
}
```

`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€[Server Components](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/01-server-components)ã‚’ä½¿ç”¨ã—ã¦ã€ReactComponent å†…ã§ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’å…±æœ‰ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€server ã‹ã‚‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸ HTML ã‚’ç¶­æŒã—ãªãŒã‚‰ã€client ã¸é€ã‚‹ JavaScript ã®é‡ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

`cache`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’`no-store`ã«è¨­å®šã™ã‚‹ã“ã¨ã§ã€ãƒ•ã‚§ãƒƒãƒã—ãŸãƒ‡ãƒ¼ã‚¿ãŒ[never ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã¹ãã§ã¯ãªã„](/ja/javascript/next.js/v14/02-app/01-building-your-application/02-data-fetching/01-fetching-caching-and-revalidating)ã“ã¨ã‚’ç¤ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®`getServerSideProps`ã«ä¼¼ã¦ã„ã¾ã™ã€‚

```tsx:app/dashboard/page.tsx
// `app` directory

// This function can be named anything
async function getProjects() {
  const res = await fetch(`https://...`, { cache: 'no-store' })
  const projects = await res.json()

  return projects
}

export default async function Dashboard() {
  const projects = await getProjects()

  return (
    <ul>
      {projects.map((project) => (
        <li key={project.id}>{project.name}</li>
      ))}
    </ul>
  )
}
```

```jsx:app/dashboard/page.js
// `app` directory

// This function can be named anything
async function getProjects() {
  const res = await fetch(`https://...`, { cache: 'no-store' })
  const projects = await res.json()

  return projects
}

export default async function Dashboard() {
  const projects = await getProjects()

  return (
    <ul>
      {projects.map((project) => (
        <li key={project.id}>{project.name}</li>
      ))}
    </ul>
  )
}
```

#### Request Object ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€Node.js HTTP API ã«åŸºã¥ã„ã¦ Request ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚

ãŸã¨ãˆã°ã€`getServerSideProps`ã‹ã‚‰`req` object ã‚’å–å¾—ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® cookies ã‚„ headers ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```jsx:pages/index.js
// `pages` directory

export async function getServerSideProps({ req, query }) {
  const authHeader = req.getHeaders()['authorization'];
  const theme = req.cookies['theme'];

  return { props: { ... }}
}

export default function Page(props) {
  return ...
}
```

`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€request ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®æ–°ã—ã„èª­ã¿å–ã‚Šå°‚ç”¨ã®æ©Ÿèƒ½ã‚’å…¬é–‹ã—ã¾ã™ã€‚

- [`headers()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/headers): Web ã® Headers API ã«åŸºã¥ã„ã¦ãŠã‚Šã€[Server Components](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/01-server-components)å†…ã§ request headers ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚
- [`cookies()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/cookies): Web ã® Cookies API ã«åŸºã¥ãã€[Server Components](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/01-server-components)å†…ã§ cookies ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

```tsx:app/page.tsx
// `app` directory
import { cookies, headers } from 'next/headers'

async function getData() {
  const authHeader = headers().get('authorization')

  return '...'
}

export default async function Page() {
  // You can use `cookies()` or `headers()` inside Server Components
  // directly or in your data fetching function
  const theme = cookies().get('theme')
  const data = await getData()
  return '...'
}
```

```jsx:app/page.js
// `app` directory
import { cookies, headers } from 'next/headers'

async function getData() {
  const authHeader = headers().get('authorization')

  return '...'
}

export default async function Page() {
  // You can use `cookies()` or `headers()` inside Server Components
  // directly or in your data fetching function
  const theme = cookies().get('theme')
  const data = await getData()
  return '...'
}
```

#### Static Site Generation(`getStaticProps`)

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`getStaticProps`é–¢æ•°ãŒä½¿ç”¨ã•ã‚Œã¦ã€build ã®æ™‚ã«ãƒšãƒ¼ã‚¸ã‚’äº‹å‰ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å¤–éƒ¨ã® API ã‹ã‚‰ã¾ãŸã¯ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ fetch ã—ã¦ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒšãƒ¼ã‚¸å…¨ä½“ã«æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€build ã®éç¨‹ã§ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```jsx:pages/index.js
// `pages` directory

export async function getStaticProps() {
  const res = await fetch(`https://...`)
  const projects = await res.json()

  return { props: { projects } }
}

export default function Index({ projects }) {
  return projects.map((project) => <div>{project.name}</div>)
}
```

`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€[`fetch()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/fetch)ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã¯ default ã§ `cache: 'force-cache'` ã«è¨­å®šã•ã‚Œã€request ãƒ‡ãƒ¼ã‚¿ãŒæ‰‹å‹•ã§ç„¡åŠ¹ã«ã•ã‚Œã‚‹ã¾ã§ cache ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ `pages` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `getStaticProps` ã¨ä¼¼ã¦ã„ã¾ã™ã€‚

```jsx:app/page.js
// `app` directory

// This function can be named anything
async function getProjects() {
  const res = await fetch(`https://...`)
  const projects = await res.json()

  return projects
}

export default async function Index() {
  const projects = await getProjects()

  return projects.map((project) => <div>{project.name}</div>)
}
```

#### Dynamic paths (`getStaticPaths`)

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`getStaticPaths`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã€build æ™‚ã«äº‹å‰ã«æç”»ã™ã‚‹ã¹ã dynamic paths ã‚’å®šç¾©ã—ã¾ã™ã€‚

```jsx:pages/posts/[id].js
// `pages` directory
import PostLayout from '@/components/post-layout'

export async function getStaticPaths() {
  return {
    paths: [{ params: { id: '1' } }, { params: { id: '2' } }],
  }
}

export async function getStaticProps({ params }) {
  const res = await fetch(`https://.../posts/${params.id}`)
  const post = await res.json()

  return { props: { post } }
}

export default function Post({ post }) {
  return <PostLayout post={post} />
}
```

`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`getStaticPaths` ã¯ [`generateStaticParams`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/generate-static-params) ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

[`generateStaticParams`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/generate-static-params)ã¯ã€`getStaticPaths`ã¨åŒæ§˜ã®å‹•ä½œã‚’ã—ã¾ã™ãŒã€route ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿”ã™ãŸã‚ã®ç°¡ç•¥åŒ–ã•ã‚ŒãŸ API ã‚’æŒã¡ã€[layouts](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/02-pages-and-layouts)ã®ä¸­ã§ä½¿ç”¨ã§ãã¾ã™ã€‚`generateStaticParams`ã®è¿”ã‚Šå€¤ã®å½¢çŠ¶ã¯ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸ`param`Object ã®é…åˆ—ã‚„è§£æ±ºã•ã‚ŒãŸ paths ã® string ã§ã¯ãªãã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®é…åˆ—ã§ã™ã€‚

```jsx:app/posts/[id]/page.js
// `app` directory
import PostLayout from '@/components/post-layout'

export async function generateStaticParams() {
  return [{ id: '1' }, { id: '2' }]
}

async function getPost(params) {
  const res = await fetch(`https://.../posts/${params.id}`)
  const post = await res.json()

  return post
}

export default async function Post({ params }) {
  const post = await getPost(params)

  return <PostLayout post={post} />
}
```

æ–°ã—ã„ãƒ¢ãƒ‡ãƒ«ã«ã¨ã£ã¦ã€`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ `getStaticPaths`ã‚ˆã‚Šã‚‚ `generateStaticParams`ã¨ã„ã†åå‰ã‚’ä½¿ç”¨ã™ã‚‹æ–¹ãŒé©åˆ‡ã§ã™ã€‚`get`ã¨ã„ã†æ¥é ­è¾ã¯ã€ã‚‚ã£ã¨èª¬æ˜çš„ãª `generate`ã«ç½®ãæ›ãˆã‚‰ã‚Œã€`getStaticProps`ã¨ `getServerSideProps`ãŒå¿…è¦ãªããªã£ãŸãŸã‚ã€ä»Šã§ã¯å˜ç‹¬ã§ã®ä½¿ç”¨ãŒé©åˆ‡ã§ã™ã€‚ã¾ãŸã€ `Paths`ã¨ã„ã†ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯ã€è¤‡æ•°ã® dynamic ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æŒã¤ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«é©ã—ãŸ`Params`ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

---

#### `fallback`ã®ç½®ãæ›ãˆ

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`getStaticPaths`ã‹ã‚‰è¿”ã•ã‚Œã‚‹`fallback`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦ã€ build æ™‚ã«äº‹å‰ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„ãƒšãƒ¼ã‚¸ã®å‹•ä½œã‚’å®šç¾©ã—ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ã€ãƒšãƒ¼ã‚¸ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹é–“ã« fallback ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«`true`ã«è¨­å®šã™ã‚‹ã‹ã€404 ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«`false`ã«è¨­å®šã™ã‚‹ã‹ã€ã¾ãŸã¯ request æ™‚ã«ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«`blocking`ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```jsx:pages/posts/[id].js
// `pages` directory

export async function getStaticPaths() {
  return {
    paths: [],
    fallback: 'blocking'
  };
}

export async function getStaticProps({ params }) {
  ...
}

export default function Post({ post }) {
  return ...
}
```

`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€[`config.dynamicParams`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£](/ja/javascript/next.js/v14/02-app/02-api-reference/02-file-conventions/route-segment-config#dynamicparams)ãŒã€[`generateStaticParams`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/generate-static-params)ã®å¤–éƒ¨ã«ã‚ã‚‹ params ã®å‡¦ç†æ–¹æ³•ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

- **`true`**: ( default ) `generateStaticParams` ã«å«ã¾ã‚Œã¦ã„ãªã„ Dynamic ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¯ã€è¦æ±‚ã«å¿œã˜ã¦ç”Ÿæˆã•ã‚Œã¾ã™ã€‚
- **`false`**: `generateStaticParams`ã«å«ã¾ã‚Œã¦ã„ãªã„ Dynamic ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¯ 404 ã‚’è¿”ã—ã¾ã™ã€‚

ã“ã‚Œã¯ `pages` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `getStaticPaths` ã® `fallback: true | false | 'blocking'` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç½®ãæ›ãˆã¾ã™ã€‚`fallback: 'blocking'` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€`'blocking'`ã¨ `true` ã¨ã®é•ã„ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§ã¯ç„¡è¦–ã§ãã‚‹ç¨‹åº¦ã ã‹ã‚‰ `dynamicParams`ã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

```jsx:app/posts/[id]/page.js
// `app` directory

export const dynamicParams = true;

export async function generateStaticParams() {
  return [...]
}

async function getPost(params) {
  ...
}

export default async function Post({ params }) {
  const post = await getPost(params);

  return ...
}
```

[`dynamicParams`](/ja/javascript/next.js/v14/02-app/02-api-reference/02-file-conventions/route-segment-config#dynamicparams)ãŒ`true`ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ(â€œ default )ã€ç”Ÿæˆã•ã‚Œã¦ã„ãªã„ route ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒè¦æ±‚ã•ã‚ŒãŸã¨ãã€ãã‚Œã¯ servers ã§ rendering ã•ã‚Œ cache ã•ã‚Œã¾ã™ã€‚

#### Incremental Static Regeneration (`getStaticProps`ã¨`revalidate`ã‚’ä½¿ç”¨ã—ã¦)

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€`getStaticProps`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦`revalidate`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ä¸€å®šæ™‚é–“å¾Œã«ãƒšãƒ¼ã‚¸ã‚’è‡ªå‹•çš„ã«å†ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```jsx:pages/index.js
// `pages` directory

export async function getStaticProps() {
  const res = await fetch(`https://.../posts`)
  const posts = await res.json()

  return {
    props: { posts },
    revalidate: 60,
  }
}

export default function Index({ posts }) {
  return (
    <Layout>
      <PostList posts={posts} />
    </Layout>
  )
}
```

`app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€[`fetch()`](/ja/javascript/next.js/v14/02-app/02-api-reference/04-functions/fetch)ã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã¯ `revalidate` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã€ã“ã‚Œã«ã‚ˆã‚ŠæŒ‡å®šã•ã‚ŒãŸç§’æ•°ã«ã‚ãŸã£ã¦ request ã‚’ cache ã—ã¾ã™ã€‚

```jsx:app/page.js
// `app` directory

async function getPosts() {
  const res = await fetch(`https://.../posts`, { next: { revalidate: 60 } })
  const data = await res.json()

  return data.posts
}

export default async function PostList() {
  const posts = await getPosts()

  return posts.map((post) => <div>{post.name}</div>)
}
```

#### API Routes

`pages/api`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€ä½•ã‚‚å¤‰ã‚ã‚‰ãšã« API Routes ãŒå¼•ãç¶šãä½œå‹•ã—ã¾ã™ã€‚ã—ã‹ã—ã€ãã‚Œã‚‰ã¯`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®[Route Handlers](/ja/javascript/next.js/v14/02-app/01-building-your-application/01-routing/12-route-handlers)ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸã€‚

Route Handlers allow you to create custom request handlers for a given route using the Web [Request](https://developer.mozilla.org/docs/Web/API/Request) and [Response](https://developer.mozilla.org/docs/Web/API/Response) APIs.

```ts:app/api/route.ts
export async function GET(request: Request) {}
```

```js:app/api/route.js
export async function GET(request) {}
```

> **Good to know**: ä»¥å‰ APIroutes ã‚’ä½¿ç”¨ã—ã¦ client ã‹ã‚‰å¤–éƒ¨ã® API ã‚’å‘¼ã³å‡ºã—ã¦ã„ãŸå ´åˆã€ä»£ã‚ã‚Šã«[Server Components](/ja/javascript/next.js/v14/02-app/01-building-your-application/03-rendering/01-server-components)ã‚’ä½¿ç”¨ã—ã¦å®‰å…¨ã« fetch ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ [data fetching](/ja/javascript/next.js/v14/02-app/01-building-your-application/02-data-fetching/01-fetching-caching-and-revalidating)ã«ã¤ã„ã¦è©³ã—ãå­¦ã¶ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 7ï¼šã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

`pages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆã¯`pages/_app.js`ã®ã¿ã«åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€ã“ã®åˆ¶é™ãŒè§£é™¤ã•ã‚Œã¾ã—ãŸã€‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª styles ã¯ã€ä»»æ„ã® layout ã€ãƒšãƒ¼ã‚¸ã€ã¾ãŸã¯ component ã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- [CSS Modules](/ja/javascript/next.js/v14/02-app/01-building-your-application/05-styling/01-css-modules)
- [Tailwind CSS](/ja/javascript/next.js/v14/02-app/01-building-your-application/05-styling/02-tailwind-css)
- [ã‚°ãƒ­ãƒ¼ãƒãƒ« Styles](/ja/javascript/next.js/v14/02-app/01-building-your-application/05-styling/01-css-modules#global-styles)
- [CSS-in-JS](/ja/javascript/next.js/v14/02-app/01-building-your-application/05-styling/03-css-in-js)
- [å¤–éƒ¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ](/ja/javascript/next.js/v14/02-app/01-building-your-application/05-styling/01-css-modules#external-stylesheets)
- [Sass](/ja/javascript/next.js/v14/02-app/01-building-your-application/05-styling/04-sass)

#### Tailwind CSS

ã‚‚ã— Tailwind CSS ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãªã‚‰ã€`app`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`tailwind.config.js`ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```js:tailwind.config.js
module.exports = {
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}', // <-- Add this line
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
  ],
}
```

ã¾ãŸã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª styles ã‚’ã‚ãªãŸã® `app/layout.js` ãƒ•ã‚¡ã‚¤ãƒ«ã« import ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```jsx:app/layout.js
import '../styles/globals.css'

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

[Tailwind CSS ã‚’ä½¿ã£ãŸã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°](/ja/javascript/next.js/v14/02-app/01-building-your-application/05-styling/02-tailwind-css)ã«ã¤ã„ã¦ã‚‚ã£ã¨è©³ã—ãå­¦ã³ã¾ã—ã‚‡ã†ã€‚

## Codemods

Next.js ã¯ã€æ©Ÿèƒ½ãŒéæ¨å¥¨ã«ãªã£ãŸã¨ãã«ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã® Codemod å¤‰æ›ã‚’æä¾›ã—ã¾ã™ã€‚è©³ç´°ã¯[Codemods](/ja/javascript/next.js/v14/02-app/01-building-your-application/11-upgrading/01-codemods)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
